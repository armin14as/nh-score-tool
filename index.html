<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="NH Score - Wissenschaftlich fundiertes Gesundheitsbewertungssystem" />
<title>NH SCORE ‚Äì Professional Health Assessment</title>
<style>
  :root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --success: #10b981;
    --warning: #f59e0b;
    --error: #ef4444;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --gray-900: #111827;
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --text-primary: #f8fafc;
    --text-secondary: #cbd5e1;
    --border-color: rgba(148, 163, 184, 0.1);
    --glass-bg: rgba(30, 41, 59, 0.4);
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
  }

  /* Enhanced Progress Bar */
  .progress-header {
    position: sticky;
    top: 0;
    background: var(--glass-bg);
    backdrop-filter: blur(16px);
    border-bottom: 1px solid var(--border-color);
    z-index: 100;
    padding: 1rem 0;
    box-shadow: var(--shadow);
  }
  
  .progress-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }
  
  .progress-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
    min-width: 200px;
  }
  
  .progress-bar-container {
    flex: 1;
    max-width: 400px;
    height: 10px;
    background: var(--gray-800);
    border-radius: 5px;
    overflow: hidden;
    position: relative;
  }
  
  .progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--success));
    border-radius: 5px;
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    width: 0%;
    position: relative;
    overflow: hidden;
  }

  .progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100px;
    width: 100px;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { left: -100px; }
    100% { left: 100%; }
  }

  /* Category Navigation */
  .category-nav {
    display: flex;
    gap: 0.75rem;
    align-items: center;
  }
  
  .category-dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--gray-600);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    border: 2px solid transparent;
  }
  
  .category-dot.completed { 
    background: var(--success); 
    box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
  }
  .category-dot.active { 
    background: var(--primary); 
    transform: scale(1.3); 
    border-color: rgba(99, 102, 241, 0.3);
  }
  .category-dot:hover { 
    transform: scale(1.2); 
    box-shadow: 0 0 8px rgba(255,255,255,0.2);
  }

  /* Action Buttons */
  .action-buttons {
    display: flex;
    gap: 0.75rem;
  }
  
  .btn {
    padding: 0.625rem 1.25rem;
    border: 1px solid var(--border-color);
    background: var(--glass-bg);
    color: var(--text-primary);
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    backdrop-filter: blur(8px);
  }
  
  .btn:hover {
    background: var(--gray-700);
    border-color: var(--gray-600);
    transform: translateY(-1px);
    box-shadow: var(--shadow);
  }
  
  .btn.primary {
    background: var(--primary);
    border-color: var(--primary);
  }
  
  .btn.primary:hover {
    background: var(--primary-dark);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
  }

  /* Main Layout */
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 2rem;
  }

  /* Score Panel - Enhanced */
  .score-panel {
    background: var(--glass-bg);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 2rem;
    backdrop-filter: blur(16px);
    height: fit-content;
    position: sticky;
    top: 140px;
    box-shadow: var(--shadow-lg);
  }
  
  .score-header h3 {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }
  
  .score-date {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 2rem;
  }
  
  .score-ring {
    position: relative;
    width: 140px;
    height: 140px;
    margin: 0 auto 1.5rem;
  }
  
  .score-circle {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    background: conic-gradient(var(--primary) 0deg, var(--gray-700) 0deg);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: all 0.5s ease;
  }
  
  .score-circle::before {
    content: '';
    width: 90px;
    height: 90px;
    background: var(--bg-secondary);
    border-radius: 50%;
    position: absolute;
  }
  
  .score-value {
    position: relative;
    z-index: 1;
    font-size: 1.75rem;
    font-weight: 700;
    text-align: center;
    line-height: 1.2;
  }
  
  .score-percentage {
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-weight: 500;
  }
  
  .score-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid var(--border-color);
  }
  
  .stat-item {
    text-align: center;
  }
  
  .stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--success);
    margin-bottom: 0.25rem;
  }
  
  .stat-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 500;
  }

  /* Hero Section - Enhanced */
  .hero-section {
    text-align: center;
    padding: 4rem 0 3rem;
    margin-bottom: 2rem;
    border-bottom: 1px solid var(--border-color);
    position: relative;
  }

  .hero-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    width: 200px;
    height: 200px;
    background: radial-gradient(circle, rgba(99, 102, 241, 0.1), transparent);
    border-radius: 50%;
    transform: translateX(-50%);
    z-index: -1;
  }
  
  .main-title {
    font-size: clamp(3rem, 8vw, 5rem);
    font-weight: 900;
    background: linear-gradient(135deg, var(--primary), #8b5cf6, #06b6d4);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1.5rem;
    animation: gradientShift 8s ease-in-out infinite;
    letter-spacing: -0.02em;
  }
  
  @keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  
  .subtitle {
    font-size: clamp(1.125rem, 3vw, 1.375rem);
    color: var(--text-secondary);
    max-width: 900px;
    margin: 0 auto;
    line-height: 1.6;
    font-weight: 400;
  }

  /* Categories - Enhanced */
  .categories {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }
  
  .category {
    background: var(--glass-bg);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 2rem;
    backdrop-filter: blur(16px);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .category::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--success));
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .category.active {
    border-color: var(--primary);
    box-shadow: 0 0 0 1px var(--primary), var(--shadow-lg);
    transform: translateY(-2px);
  }

  .category.active::before {
    opacity: 1;
  }
  
  .category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    gap: 1rem;
  }
  
  .category-title {
    font-size: 1.375rem;
    font-weight: 600;
    flex: 1;
  }
  
  .category-score {
    background: var(--gray-800);
    padding: 0.625rem 1.25rem;
    border-radius: 25px;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
  }
  
  .category-progress {
    width: 100%;
    height: 6px;
    background: var(--gray-800);
    border-radius: 3px;
    margin-bottom: 2rem;
    overflow: hidden;
  }
  
  .category-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--success));
    border-radius: 3px;
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    width: 0%;
    position: relative;
  }

  /* Questions - Enhanced */
  .question {
    margin-bottom: 2rem;
    padding: 1.5rem;
    border: 2px solid transparent;
    border-radius: 12px;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.01);
  }
  
  .question:hover {
    background: rgba(255, 255, 255, 0.03);
    border-color: var(--border-color);
  }
  
  .question.answered {
    border-color: var(--success);
    background: rgba(16, 185, 129, 0.05);
  }
  
  .question-label {
    display: block;
    margin-bottom: 1.25rem;
    font-weight: 500;
    font-size: 1.0625rem;
    line-height: 1.5;
  }
  
  .question-number {
    color: var(--primary);
    font-weight: 600;
    margin-right: 0.75rem;
    font-size: 0.875rem;
  }

  /* Radio Groups - Enhanced */
  .radio-group {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }
  
  .radio-option {
    position: relative;
  }
  
  .radio-option input {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }
  
  .radio-option label {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem 1.25rem;
    background: var(--gray-800);
    border: 2px solid var(--gray-700);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.9375rem;
    font-weight: 500;
    text-align: center;
    min-height: 52px;
    position: relative;
    overflow: hidden;
  }

  .radio-option label::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transition: left 0.5s ease;
  }
  
  .radio-option label:hover {
    border-color: var(--gray-600);
    background: var(--gray-700);
    transform: translateY(-1px);
  }

  .radio-option label:hover::before {
    left: 100%;
  }
  
  .radio-option input:checked + label {
    border-color: var(--primary);
    background: rgba(99, 102, 241, 0.15);
    color: var(--primary);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
  }
  
  .radio-option:nth-child(1) input:checked + label {
    border-color: var(--error);
    background: rgba(239, 68, 68, 0.15);
    color: var(--error);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
  }
  
  .radio-option:nth-child(2) input:checked + label {
    border-color: var(--warning);
    background: rgba(245, 158, 11, 0.15);
    color: var(--warning);
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
  }
  
  .radio-option:nth-child(3) input:checked + label {
    border-color: var(--success);
    background: rgba(16, 185, 129, 0.15);
    color: var(--success);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
  }

  /* Keyboard Navigation */
  .radio-option input:focus + label {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }

  /* Notifications - Enhanced */
  .notification {
    position: fixed;
    top: 1rem;
    right: 1rem;
    padding: 1rem 1.5rem;
    background: var(--success);
    color: white;
    border-radius: 10px;
    font-weight: 500;
    z-index: 1000;
    transform: translateX(100%);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: var(--shadow-lg);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .notification.show {
    transform: translateX(0);
  }
  
  .notification.error {
    background: var(--error);
  }

  /* Auto-save indicator - Enhanced */
  .autosave-indicator {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 500;
  }
  
  .autosave-indicator.saving {
    color: var(--warning);
  }
  
  .autosave-indicator.saved {
    color: var(--success);
  }

  .autosave-indicator .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: currentColor;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* Loading states */
  .loading {
    opacity: 0.6;
    pointer-events: none;
  }

  /* Error states */
  .error-state {
    text-align: center;
    padding: 2rem;
    color: var(--error);
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid var(--error);
    border-radius: 8px;
    margin: 1rem 0;
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .container {
      grid-template-columns: 1fr;
      gap: 1.5rem;
      padding: 1.5rem 1rem;
    }
    
    .score-panel {
      position: static;
      order: -1;
    }
    
    .hero-section {
      padding: 2rem 0 2rem;
    }
  }
  
  @media (max-width: 768px) {
    .progress-content {
      flex-direction: column;
      gap: 1rem;
    }
    
    .progress-info {
      order: 1;
      min-width: auto;
    }
    
    .action-buttons {
      flex-wrap: wrap;
    }
    
    .radio-group {
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }
    
    .hero-section {
      padding: 1rem 0 1.5rem;
    }
    
    .main-title {
      font-size: clamp(2rem, 10vw, 3rem);
    }
    
    .subtitle {
      font-size: clamp(0.9375rem, 3.5vw, 1.125rem);
    }
    
    .category {
      padding: 1.5rem;
    }
    
    .container {
      padding: 1rem;
    }

    .score-panel {
      padding: 1.5rem;
    }

    .question {
      padding: 1.25rem;
    }
  }

  /* Accessibility improvements */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  @media (prefers-contrast: high) {
    :root {
      --border-color: rgba(148, 163, 184, 0.3);
      --text-secondary: #e2e8f0;
    }
  }
</style>
</head>
<body>
  <div class="progress-header">
    <div class="progress-content">
      <div class="progress-info">
        <span id="progressText">Frage 0 von 50</span>
        <div class="autosave-indicator" id="autosaveIndicator">
          <div class="status-dot"></div>
          <span>Automatisch gespeichert</span>
        </div>
      </div>
      
      <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      
      <div class="category-nav" id="categoryNav" role="navigation" aria-label="Kategorien Navigation"></div>
      
      <div class="action-buttons">
        <button class="btn" onclick="window.exportPDF()" title="Als PDF exportieren" aria-label="Ergebnisse als PDF exportieren">
          <span>üìÑ</span> Export
        </button>
        <button class="btn primary" onclick="window.resetAll()" title="Alle Antworten zur√ºcksetzen" aria-label="Assessment zur√ºcksetzen">
          üîÑ Reset
        </button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="main-content">
      <!-- Hero Section -->
      <header class="hero-section">
        <h1 class="main-title">NH Score</h1>
        <p class="subtitle">Wissenschaftlich fundiertes 100-Punkte-System f√ºr umfassende Gesundheit & Leistungsf√§higkeit</p>
      </header>

      <main class="categories" id="categories" role="main"></main>
    </div>
    
    <aside class="score-panel" role="complementary" aria-label="Aktueller Gesundheitsscore">
      <div class="score-header">
        <h3>Gesundheitsscore</h3>
        <div class="score-date" id="scoreDate"></div>
      </div>
      
      <div class="score-ring">
        <div class="score-circle" id="scoreCircle" role="img" aria-label="Score Kreis">
          <div class="score-value">
            <div id="totalScore">0</div>
            <div class="score-percentage" id="scorePercentage">0%</div>
          </div>
        </div>
      </div>
      
      <div class="score-stats">
        <div class="stat-item">
          <div class="stat-value" id="answeredCount">0</div>
          <div class="stat-label">Beantwortet</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="completedCategories">0</div>
          <div class="stat-label">Kategorien</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="averageScore">0%</div>
          <div class="stat-label">Durchschnitt</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="timeSpent">0m</div>
          <div class="stat-label">Zeit</div>
        </div>
      </div>
    </aside>
  </div>

  <div class="notification" id="notification" role="alert"></div>

  <script>
    // Enhanced ES6+ Implementation with enterprise patterns
    class HealthAssessment {
      constructor() {
        this.categories = [
          {
            title: 'Schlaf & Erholung',
            questions: [
              'Schl√§fst du mindestens 7‚Äì8 Stunden pro Nacht?',
              'Hast du einen regelm√§√üigen Schlaf-Wach-Rhythmus?',
              'Wachst du ohne Wecker erholt auf?',
              'Schl√§fst du ohne Unterbrechungen durch?',
              'Vermeidest du Blaulicht 2h vor dem Schlafengehen?',
              'Schl√§fst du in einem v√∂llig dunklen Raum?',
              'Wachst du erfrischt und energiegeladen auf?',
              'Vermeidest du sp√§te und schwere Mahlzeiten?',
              'Kommst du ohne Schlafmittel oder Alkohol aus?',
              'F√ºhlst du dich tags√ºber wach und konzentriert?'
            ]
          },
          {
            title: 'Ern√§hrung & Supplements',
            questions: [
              'Verzichtest du weitgehend auf raffinierten Zucker?',
              'Isst du t√§glich mindestens 5 Portionen Gem√ºse/Obst?',
              'Trinkst du t√§glich 2-3 Liter reines Wasser?',
              'Verwendest du Supplements gezielt nach Bedarf?',
              'Hast du regelm√§√üige und bewusste Essenszeiten?',
              'Isst du ballaststoffreich und n√§hrstoffdicht?',
              'Vermeidest du hochverarbeitete Fertigprodukte?',
              'Meidest du k√ºnstliche Zus√§tze und Konservierungsstoffe?',
              'Hast du eine gesunde Verdauung ohne Probleme?',
              'Verzichtest du auf k√ºnstliche S√º√üstoffe?'
            ]
          },
          {
            title: 'Training & Bewegung',
            questions: [
              'Bewegst du dich t√§glich mindestens 30 Minuten?',
              'Trainierst du 3-4x pro Woche strukturiert?',
              'Schaffst du problemlos 10.000 Schritte t√§glich?',
              'Bist du schmerzfrei und beweglich?',
              'Hast du klare sportliche Ziele und Motivation?',
              'Folgst du einem durchdachten Trainingsplan?',
              'Trainierst du regelm√§√üig deine Ausdauer?',
              'Trainierst du systematisch deine Kraft?',
              'Bist du flexibel und hast gute Mobilit√§t?',
              'Kannst du problemlos l√§nger laufen/gehen?'
            ]
          },
          {
            title: 'Mindset & Stressmanagement',
            questions: [
              'F√ºhlst du dich selten √ºberw√§ltigt oder gestresst?',
              'Praktizierst du regelm√§√üig Meditation oder Achtsamkeit?',
              'Umgibst du dich mit positiven Einfl√ºssen?',
              'Hast du klare Lebensziele und Priorit√§ten?',
              'Lebst du nach deinen pers√∂nlichen Werten?',
              'Hast du eine grunds√§tzlich optimistische Einstellung?',
              'Vermeidest du Multitasking und Ablenkungen?',
              'Hast du starke soziale Verbindungen und Unterst√ºtzung?',
              'Kannst du nach der Arbeit wirklich abschalten?',
              'F√ºhlst du dich meistens gl√ºcklich und erf√ºllt?'
            ]
          },
          {
            title: 'Lifestyle & Umwelt',
            questions: [
              'Rauchst du nicht und meidest Passivrauchen?',
              'Trinkst du maximal 1-2 Gl√§ser Alkohol pro Woche?',
              'Vermeidest du Plastik bei Lebensmitteln und Getr√§nken?',
              'Hast du Zugang zu sauberem, gefiltertem Wasser?',
              'Meidest du sch√§dliche Chemikalien im Alltag?',
              'Verwendest du nat√ºrliche K√∂rperpflege ohne Toxine?',
              'Schl√§fst du in einem schadstofffreien Umfeld?',
              'Bekommst du t√§glich nat√ºrliches Tageslicht?',
              'Verbringst du regelm√§√üig Zeit in der Natur?',
              'F√ºhrst du einen bewusst nachhaltigen Lebensstil?'
            ]
          }
        ];
        
        this.answers = this.loadData() || this.initializeAnswers();
        this.startTime = Date.now();
        this.autosaveInterval = null;
        this.updateTimeInterval = null;
        this.isInitialized = false;
        
        this.init();
      }
      
      initializeAnswers() {
        return this.categories.map(cat => new Array(cat.questions.length).fill(null));
      }
      
      init() {
        try {
          this.renderCategories();
          this.renderCategoryNav();
          this.updateUI();
          this.setupKeyboardNavigation();
          this.startAutosave();
          this.updateTimeSpent();
          this.isInitialized = true;
        } catch (error) {
          console.error('Initialization error:', error);
          this.showError('Fehler beim Laden der Anwendung. Bitte laden Sie die Seite neu.');
        }
      }
      
      renderCategories() {
        const container = document.getElementById('categories');
        if (!container) throw new Error('Categories container not found');
        
        container.innerHTML = '';
        
        this.categories.forEach((category, catIdx) => {
          const categoryEl = this.createCategoryElement(category, catIdx);
          container.appendChild(categoryEl);
        });
      }
      
      createCategoryElement(category, catIdx) {
        const categoryEl = document.createElement('section');
        categoryEl.className = 'category';
        categoryEl.id = `category-${catIdx}`;
        categoryEl.setAttribute('aria-labelledby', `category-title-${catIdx}`);
        
        categoryEl.innerHTML = `
          <div class="category-header">
            <h2 class="category-title" id="category-title-${catIdx}">${category.title}</h2>
            <div class="category-score" id="score-${catIdx}" aria-label="Aktuelle Punkte">0 / 20</div>
          </div>
          <div class="category-progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="category-progress-fill" id="progress-${catIdx}"></div>
          </div>
          <div class="questions">
            ${category.questions.map((question, qIdx) => 
              this.createQuestionHTML(question, catIdx, qIdx)
            ).join('')}
          </div>
        `;
        
        return categoryEl;
      }
      
      createQuestionHTML(question, catIdx, qIdx) {
        const isAnswered = this.answers[catIdx][qIdx] !== null;
        const fieldsetId = `cat${catIdx}_q${qIdx}`;
        
        return `
          <div class="question ${isAnswered ? 'answered' : ''}" id="question-${catIdx}-${qIdx}">
            <fieldset>
              <legend class="question-label">
                <span class="question-number">${qIdx + 1}.</span>
                ${question}
              </legend>
              <div class="radio-group" role="radiogroup" aria-labelledby="legend-${fieldsetId}">
                ${['Nein', 'Teilweise', 'Ja'].map((text, val) => `
                  <div class="radio-option">
                    <input type="radio" 
                           name="${fieldsetId}" 
                           value="${val}" 
                           id="${fieldsetId}_v${val}"
                           ${this.answers[catIdx][qIdx] === val ? 'checked' : ''}
                           onchange="window.healthApp.handleAnswer(${catIdx}, ${qIdx}, ${val})"
                           aria-describedby="question-${catIdx}-${qIdx}">
                    <label for="${fieldsetId}_v${val}">${text}</label>
                  </div>
                `).join('')}
              </div>
            </fieldset>
          </div>
        `;
      }
      
      renderCategoryNav() {
        const nav = document.getElementById('categoryNav');
        if (!nav) return;
        
        nav.innerHTML = '';
        
        this.categories.forEach((cat, idx) => {
          const dot = document.createElement('div');
          dot.className = 'category-dot';
          dot.title = cat.title;
          dot.setAttribute('role', 'button');
          dot.setAttribute('aria-label', `Springe zu ${cat.title}`);
          dot.onclick = () => this.scrollToCategory(idx);
          dot.onkeydown = (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              this.scrollToCategory(idx);
            }
          };
          dot.tabIndex = 0;
          nav.appendChild(dot);
        });
      }
      
      handleAnswer(catIdx, qIdx, value) {
        if (!this.isInitialized) return;
        
        try {
          this.answers[catIdx][qIdx] = parseInt(value);
          
          // Update question state with smooth transition
          const questionEl = document.getElementById(`question-${catIdx}-${qIdx}`);
          if (questionEl) {
            questionEl.classList.add('answered');
          }
          
          // Debounced UI update for better performance
          this.debouncedUpdateUI();
          this.saveData();
          this.showAutosaveIndicator('saving');
          
          // Auto-advance to next question
          setTimeout(() => this.focusNextQuestion(catIdx, qIdx), 150);
          
        } catch (error) {
          console.error('Answer handling error:', error);
          this.showNotification('Fehler beim Speichern der Antwort', 'error');
        }
      }
      
      // Debounced UI update for better performance
      debouncedUpdateUI = this.debounce(() => {
        this.updateUI();
      }, 100);
      
      debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }
      
      focusNextQuestion(catIdx, qIdx) {
        // Find next unanswered question with improved logic
        for (let c = catIdx; c < this.categories.length; c++) {
          const startQ = (c === catIdx) ? qIdx + 1 : 0;
          for (let q = startQ; q < this.categories[c].questions.length; q++) {
            if (this.answers[c][q] === null) {
              const nextQuestion = document.getElementById(`question-${c}-${q}`);
              if (nextQuestion) {
                // Smooth scroll with better positioning
                nextQuestion.scrollIntoView({ 
                  behavior: 'smooth', 
                  block: 'center',
                  inline: 'nearest'
                });
                
                // Focus first radio button after scroll completes
                setTimeout(() => {
                  const firstRadio = nextQuestion.querySelector('input[type="radio"]');
                  if (firstRadio) firstRadio.focus();
                }, 300);
              }
              return;
            }
          }
        }
        
        // If all questions are answered, show completion notification
        this.showNotification('üéâ Alle Fragen beantwortet! Sie k√∂nnen jetzt Ihr Ergebnis exportieren.', 'success');
      }
      
      updateUI() {
        try {
          this.updateProgress();
          this.updateScorePanel();
          this.updateCategoryNav();
          this.updateCategoryStates();
        } catch (error) {
          console.error('UI update error:', error);
        }
      }
      
      updateProgress() {
        const totalQuestions = this.categories.reduce((sum, cat) => sum + cat.questions.length, 0);
        const answeredQuestions = this.answers.flat().filter(answer => answer !== null).length;
        const progress = totalQuestions > 0 ? (answeredQuestions / totalQuestions) * 100 : 0;
        
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        
        if (progressBar) {
          progressBar.style.width = `${progress}%`;
          progressBar.setAttribute('aria-valuenow', progress.toFixed(1));
        }
        
        if (progressText) {
          progressText.textContent = `Frage ${answeredQuestions} von ${totalQuestions}`;
        }
      }
      
      updateScorePanel() {
        const totalScore = this.calculateTotalScore();
        const maxScore = this.categories.reduce((sum, cat) => sum + cat.questions.length * 2, 0);
        const percentage = maxScore > 0 ? Math.round((totalScore / maxScore) * 100) : 0;
        const answeredCount = this.answers.flat().filter(answer => answer !== null).length;
        const totalQuestions = this.categories.reduce((sum, cat) => sum + cat.questions.length, 0);
        const completedCategories = this.answers.filter(catAnswers => 
          catAnswers.every(answer => answer !== null)
        ).length;
        
        // Update score circle with smooth animation
        const scoreCircle = document.getElementById('scoreCircle');
        if (scoreCircle) {
          const degrees = (percentage / 100) * 360;
          scoreCircle.style.background = `conic-gradient(var(--primary) ${degrees}deg, var(--gray-700) ${degrees}deg)`;
        }
        
        // Update values with null checks
        this.updateElementText('totalScore', totalScore);
        this.updateElementText('scorePercentage', `${percentage}%`);
        this.updateElementText('answeredCount', `${answeredCount}/${totalQuestions}`);
        this.updateElementText('completedCategories', `${completedCategories}/5`);
        this.updateElementText('averageScore', `${percentage}%`);
        this.updateElementText('scoreDate', `Stand: ${new Date().toLocaleDateString('de-DE')}`);
      }
      
      updateElementText(id, text) {
        const element = document.getElementById(id);
        if (element) element.textContent = text;
      }
      
      updateCategoryNav() {
        const dots = document.querySelectorAll('.category-dot');
        this.answers.forEach((categoryAnswers, idx) => {
          if (dots[idx]) {
            const isCompleted = categoryAnswers.every(answer => answer !== null);
            const hasAnswers = categoryAnswers.some(answer => answer !== null);
            
            dots[idx].classList.toggle('completed', isCompleted);
            dots[idx].classList.toggle('active', hasAnswers && !isCompleted);
            
            // Update aria-label for screen readers
            const status = isCompleted ? 'abgeschlossen' : hasAnswers ? 'teilweise beantwortet' : 'nicht beantwortet';
            dots[idx].setAttribute('aria-label', `${this.categories[idx].title} - ${status}`);
          }
        });
      }
      
      updateCategoryStates() {
        this.categories.forEach((category, catIdx) => {
          const categoryEl = document.getElementById(`category-${catIdx}`);
          const categoryAnswers = this.answers[catIdx];
          const answered = categoryAnswers.filter(answer => answer !== null).length;
          const score = categoryAnswers.reduce((sum, answer) => sum + (answer || 0), 0);
          const progress = category.questions.length > 0 ? (answered / category.questions.length) * 100 : 0;
          
          // Update category score and progress with null checks
          const scoreEl = document.getElementById(`score-${catIdx}`);
          const progressEl = document.getElementById(`progress-${catIdx}`);
          const progressContainer = progressEl?.parentElement;
          
          if (scoreEl) {
            scoreEl.textContent = `${score} / 20`;
            scoreEl.setAttribute('aria-label', `${score} von 20 Punkten erreicht`);
          }
          
          if (progressEl) {
            progressEl.style.width = `${progress}%`;
          }
          
          if (progressContainer) {
            progressContainer.setAttribute('aria-valuenow', progress.toFixed(1));
            progressContainer.setAttribute('aria-label', `Fortschritt: ${progress.toFixed(1)}%`);
          }
          
          // Update category visual state
          if (categoryEl) {
            const isCompleted = answered === category.questions.length;
            categoryEl.classList.toggle('active', answered > 0 && !isCompleted);
          }
        });
      }
      
      calculateTotalScore() {
        return this.answers.flat().reduce((sum, answer) => sum + (answer || 0), 0);
      }
      
      scrollToCategory(index) {
        const categoryEl = document.getElementById(`category-${index}`);
        if (categoryEl) {
          categoryEl.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start',
            inline: 'nearest'
          });
          
          // Focus first unanswered question in category
          setTimeout(() => {
            const firstUnanswered = this.answers[index].findIndex(answer => answer === null);
            if (firstUnanswered !== -1) {
              const questionEl = document.getElementById(`question-${index}-${firstUnanswered}`);
              const firstRadio = questionEl?.querySelector('input[type="radio"]');
              if (firstRadio) firstRadio.focus();
            }
          }, 500);
        }
      }
      
      setupKeyboardNavigation() {
        document.addEventListener('keydown', (e) => {
          // Enhanced keyboard navigation for radio buttons
          if (e.target.type === 'radio') {
            const name = e.target.name;
            const radios = document.querySelectorAll(`input[name="${name}"]`);
            const currentIndex = Array.from(radios).indexOf(e.target);
            
            switch(e.key) {
              case 'ArrowLeft':
              case 'ArrowUp':
                e.preventDefault();
                if (currentIndex > 0) {
                  radios[currentIndex - 1].focus();
                }
                break;
              case 'ArrowRight':
              case 'ArrowDown':
                e.preventDefault();
                if (currentIndex < radios.length - 1) {
                  radios[currentIndex + 1].focus();
                }
                break;
              case 'Enter':
              case ' ':
                e.preventDefault();
                e.target.checked = true;
                e.target.onchange();
                break;
            }
          }
          
          // Global shortcuts
          if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
              case 's':
                e.preventDefault();
                this.exportData();
                break;
              case 'r':
                e.preventDefault();
                if (confirm('Alle Daten zur√ºcksetzen?')) {
                  this.resetData();
                }
                break;
            }
          }
        });
      }
      
      startAutosave() {
        // Clear existing interval
        if (this.autosaveInterval) {
          clearInterval(this.autosaveInterval);
        }
        
        this.autosaveInterval = setInterval(() => {
          this.saveData();
          this.showAutosaveIndicator('saved');
        }, 30000); // Save every 30 seconds
      }
      
      updateTimeSpent() {
        // Clear existing interval
        if (this.updateTimeInterval) {
          clearInterval(this.updateTimeInterval);
        }
        
        this.updateTimeInterval = setInterval(() => {
          const elapsed = Math.floor((Date.now() - this.startTime) / 60000);
          this.updateElementText('timeSpent', `${elapsed}m`);
        }, 60000); // Update every minute
      }
      
      showAutosaveIndicator(state) {
        const indicator = document.getElementById('autosaveIndicator');
        if (!indicator) return;
        
        indicator.className = `autosave-indicator ${state}`;
        
        if (state === 'saving') {
          indicator.innerHTML = '<div class="status-dot"></div><span>Speichere...</span>';
          setTimeout(() => this.showAutosaveIndicator('saved'), 1000);
        } else if (state === 'saved') {
          indicator.innerHTML = '<div class="status-dot"></div><span>Automatisch gespeichert</span>';
        }
      }
      
      saveData() {
        try {
          const data = {
            answers: this.answers,
            timestamp: Date.now(),
            version: '3.1',
            startTime: this.startTime
          };
          localStorage.setItem('nh-score-data', JSON.stringify(data));
        } catch (error) {
          console.error('Save error:', error);
          this.showNotification('Fehler beim Speichern', 'error');
        }
      }
      
      loadData() {
        try {
          const saved = localStorage.getItem('nh-score-data');
          if (saved) {
            const data = JSON.parse(saved);
            if (this.validateDataStructure(data)) {
              this.startTime = data.startTime || Date.now();
              return data.answers;
            }
          }
        } catch (e) {
          console.warn('Failed to load saved data:', e);
          this.showNotification('Gespeicherte Daten konnten nicht geladen werden', 'error');
        }
        return null;
      }
      
      validateDataStructure(data) {
        if (!data || !data.answers || !Array.isArray(data.answers)) {
          return false;
        }
        
        // Check if structure matches current categories
        if (data.answers.length !== this.categories.length) {
          return false;
        }
        
        return data.answers.every((catAnswers, idx) => 
          Array.isArray(catAnswers) && 
          catAnswers.length === this.categories[idx].questions.length
        );
      }
      
      exportData() {
        try {
          const totalScore = this.calculateTotalScore();
          const maxScore = this.categories.reduce((sum, cat) => sum + cat.questions.length * 2, 0);
          const percentage = maxScore > 0 ? Math.round((totalScore / maxScore) * 100) : 0;
          const date = new Date().toLocaleDateString('de-DE');
          const answeredQuestions = this.answers.flat().filter(answer => answer !== null).length;
          const totalQuestions = this.categories.reduce((sum, cat) => sum + cat.questions.length, 0);
          
          // Enhanced category breakdown with insights
          const categoryBreakdown = this.categories.map((cat, idx) => {
            const score = this.answers[idx].reduce((sum, answer) => sum + (answer || 0), 0);
            const answered = this.answers[idx].filter(answer => answer !== null).length;
            const catPercentage = answered > 0 ? Math.round((score / (cat.questions.length * 2)) * 100) : 0;
            const status = catPercentage >= 80 ? 'üü¢ Sehr gut' : 
                          catPercentage >= 60 ? 'üü° Gut' : 
                          catPercentage >= 40 ? 'üü† Verbesserbar' : 'üî¥ Handlungsbedarf';
            
            return `
              <tr>
                <td style="padding: 12px; border-bottom: 1px solid #ddd; font-weight: 500;">${cat.title}</td>
                <td style="padding: 12px; border-bottom: 1px solid #ddd; text-align: center; font-weight: 600;">${score}/20</td>
                <td style="padding: 12px; border-bottom: 1px solid #ddd; text-align: center; font-weight: 600;">${catPercentage}%</td>
                <td style="padding: 12px; border-bottom: 1px solid #ddd; text-align: center;">${answered}/${cat.questions.length}</td>
                <td style="padding: 12px; border-bottom: 1px solid #ddd; text-align: center;">${status}</td>
              </tr>
            `;
          }).join('');
          
          const recommendations = this.generateRecommendations(percentage);
          
          const printWindow = window.open('', '_blank');
          printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
              <title>NH Score Auswertung - ${date}</title>
              <meta charset="UTF-8">
              <style>
                body { 
                  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
                  margin: 40px; 
                  color: #1f2937; 
                  line-height: 1.6;
                  background: #f9fafb;
                }
                .header { 
                  text-align: center; 
                  margin-bottom: 40px; 
                  background: white;
                  padding: 30px;
                  border-radius: 12px;
                  box-shadow: 0 4px 6px rgba(0,0,0,0.05);
                }
                .score-circle {
                  width: 160px;
                  height: 160px;
                  border-radius: 50%;
                  background: conic-gradient(#6366f1 ${(percentage/100)*360}deg, #e5e7eb ${(percentage/100)*360}deg);
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  margin: 20px auto;
                  position: relative;
                  box-shadow: 0 8px 20px rgba(99, 102, 241, 0.2);
                }
                .score-circle::before {
                  content: '';
                  width: 110px;
                  height: 110px;
                  background: white;
                  border-radius: 50%;
                  position: absolute;
                }
                .score-text {
                  position: relative;
                  z-index: 1;
                  text-align: center;
                  font-weight: bold;
                  color: #1f2937;
                }
                table { 
                  width: 100%; 
                  border-collapse: collapse; 
                  margin: 30px 0;
                  background: white;
                  border-radius: 8px;
                  overflow: hidden;
                  box-shadow: 0 4px 6px rgba(0,0,0,0.05);
                }
                th { 
                  background: #6366f1; 
                  color: white;
                  padding: 16px 12px; 
                  text-align: left;
                  font-weight: 600;
                }
                .summary, .recommendation {
                  background: white;
                  padding: 24px;
                  border-radius: 12px;
                  margin: 20px 0;
                  box-shadow: 0 4px 6px rgba(0,0,0,0.05);
                }
                .recommendation {
                  border-left: 4px solid #6366f1;
                }
                .metric {
                  display: inline-block;
                  background: #f3f4f6;
                  padding: 8px 16px;
                  border-radius: 20px;
                  margin: 4px 8px 4px 0;
                  font-weight: 600;
                }
                h1 { color: #6366f1; margin-bottom: 8px; }
                h2 { color: #374151; margin-bottom: 16px; }
                h3 { color: #6366f1; margin-bottom: 12px; }
                .footer {
                  margin-top: 40px;
                  text-align: center;
                  color: #6b7280;
                  font-size: 14px;
                  border-top: 1px solid #e5e7eb;
                  padding-top: 20px;
                }
                @media print {
                  body { background: white; margin: 20px; }
                  .header, .summary, .recommendation, table { box-shadow: none; }
                }
              </style>
            </head>
            <body>
              <div class="header">
                <h1>NH Score Gesundheitsauswertung</h1>
                <p style="font-size: 18px; color: #6b7280;"><strong>Datum:</strong> ${date}</p>
                <div class="score-circle">
                  <div class="score-text">
                    <div style="font-size: 28px;">${totalScore}</div>
                    <div style="font-size: 16px; color: #6b7280;">${percentage}%</div>
                  </div>
                </div>
                <h2 style="color: #6366f1;">Gesamtergebnis: ${totalScore} von 100 Punkten</h2>
              </div>
              
              <div class="summary">
                <h3>üìä Zusammenfassung</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin: 16px 0;">
                  <span class="metric">‚úÖ ${answeredQuestions}/${totalQuestions} Fragen</span>
                  <span class="metric">üéØ ${percentage}% Score</span>
                  <span class="metric">üìÅ ${this.answers.filter(cat => cat.every(a => a !== null)).length}/5 Kategorien</span>
                </div>
                <p><strong>Bewertung:</strong> ${this.getScoreRating(percentage)}</p>
              </div>
              
              <h3>üìã Detailauswertung nach Kategorien</h3>
              <table>
                <thead>
                  <tr>
                    <th>Kategorie</th>
                    <th style="text-align: center;">Punkte</th>
                    <th style="text-align: center;">Prozent</th>
                    <th style="text-align: center;">Beantwortet</th>
                    <th style="text-align: center;">Status</th>
                  </tr>
                </thead>
                <tbody>
                  ${categoryBreakdown}
                </tbody>
              </table>
              
              <div class="recommendation">
                <h3>üí° Pers√∂nliche Empfehlungen</h3>
                ${recommendations}
              </div>
              
              <div class="footer">
                <p><strong>NH Score</strong> - Wissenschaftlich fundiertes Gesundheitsbewertungssystem</p>
                <p>Erstellt am ${date} | Version 3.1</p>
              </div>
            </body>
            </html>
          `);
          printWindow.document.close();
          
          // Wait for content to load, then print
          setTimeout(() => {
            printWindow.print();
          }, 800);
          
          this.showNotification('üìÑ PDF wird erstellt...', 'success');
          
        } catch (error) {
          console.error('Export error:', error);
          this.showNotification('Fehler beim Exportieren', 'error');
        }
      }
      
      getScoreRating(percentage) {
        if (percentage >= 85) return 'üåü Ausgezeichnet - Vorbildlicher Gesundheitsstatus';
        if (percentage >= 70) return '‚úÖ Sehr gut - Solide Gesundheitsbasis';
        if (percentage >= 55) return 'üëç Gut - Optimierungspotential vorhanden';
        if (percentage >= 40) return '‚ö†Ô∏è Verbesserungsw√ºrdig - Fokus auf Schl√ºsselbereiche';
        return 'üö® Handlungsbedarf - Professionelle Beratung empfohlen';
      }
      
      generateRecommendations(overallPercentage) {
        const categoryScores = this.categories.map((cat, idx) => {
          const score = this.answers[idx].reduce((sum, answer) => sum + (answer || 0), 0);
          const answered = this.answers[idx].filter(answer => answer !== null).length;
          const percentage = answered > 0 ? Math.round((score / (cat.questions.length * 2)) * 100) : 0;
          return { title: cat.title, percentage, index: idx };
        });
        
        const weakestCategories = categoryScores
          .filter(cat => cat.percentage < 60)
          .sort((a, b) => a.percentage - b.percentage)
          .slice(0, 2);
        
        let recommendations = [];
        
        if (overallPercentage >= 80) {
          recommendations.push('<p><strong>üéâ Herzlichen Gl√ºckwunsch!</strong> Sie haben einen ausgezeichneten Gesundheitsstatus erreicht. Halten Sie Ihre guten Gewohnheiten bei und optimieren Sie gezielt die verbleibenden Bereiche.</p>');
        } else if (overallPercentage >= 60) {
          recommendations.push('<p><strong>üëè Sehr gute Ausgangslage!</strong> Sie haben bereits eine solide Gesundheitsbasis. Konzentrieren Sie sich auf die schw√§cheren Bereiche f√ºr weitere Verbesserungen.</p>');
        } else {
          recommendations.push('<p><strong>üí™ Guter Start!</strong> Sie haben Verbesserungspotential erkannt. Beginnen Sie mit den wichtigsten Grundlagen und arbeiten Sie sich systematisch vor.</p>');
        }
        
        if (weakestCategories.length > 0) {
          recommendations.push('<p><strong>üéØ Priorit√§re Handlungsfelder:</strong></p><ul>');
          weakestCategories.forEach(cat => {
            const advice = this.getCategoryAdvice(cat.index);
            recommendations.push(`<li><strong>${cat.title}</strong> (${cat.percentage}%): ${advice}</li>`);
          });
          recommendations.push('</ul>');
        }
        
        recommendations.push('<p><strong>üìà N√§chste Schritte:</strong> W√§hlen Sie 1-2 Bereiche aus und implementieren Sie schrittweise kleine, nachhaltige Ver√§nderungen. √úberpr√ºfen Sie Ihren Fortschritt in 4-6 Wochen erneut.</p>');
        
        return recommendations.join('');
      }
      
      getCategoryAdvice(categoryIndex) {
        const advice = [
          'Etablieren Sie feste Schlafzeiten und schaffen Sie eine optimale Schlafumgebung.',
          'Reduzieren Sie verarbeitete Lebensmittel und erh√∂hen Sie den Anteil an frischen, n√§hrstoffreichen Nahrungsmitteln.',
          'Integrieren Sie t√§gliche Bewegung in Ihren Alltag und entwickeln Sie einen strukturierten Trainingsplan.',
          'Praktizieren Sie regelm√§√üig Stressmanagement-Techniken wie Meditation oder Achtsamkeits√ºbungen.',
          'Reduzieren Sie sch√§dliche Umwelteinfl√ºsse und schaffen Sie einen ges√ºnderen Lebensraum.'
        ];
        return advice[categoryIndex] || 'Fokussieren Sie sich auf nachhaltige, kleine Verbesserungen in diesem Bereich.';
      }
      
      resetData() {
        if (!confirm('‚ö†Ô∏è M√∂chten Sie wirklich alle Antworten zur√ºcksetzen?\n\nDiese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) {
          return;
        }
        
        try {
          // Reset answers array
          this.answers = this.initializeAnswers();
          this.startTime = Date.now();
          
          // Clear localStorage
          localStorage.removeItem('nh-score-data');
          
          // Clear intervals
          if (this.autosaveInterval) {
            clearInterval(this.autosaveInterval);
          }
          if (this.updateTimeInterval) {
            clearInterval(this.updateTimeInterval);
          }
          
          // Completely re-render everything from scratch
          this.renderCategories();
          this.renderCategoryNav();
          this.updateUI();
          
          // Restart intervals
          this.startAutosave();
          this.updateTimeSpent();
          
          this.showNotification('‚úÖ Alle Daten wurden erfolgreich zur√ºckgesetzt', 'success');
          
          // Scroll to top
          window.scrollTo({ top: 0, behavior: 'smooth' });
          
        } catch (error) {
          console.error('Reset error:', error);
          this.showNotification('‚ùå Fehler beim Zur√ºcksetzen der Daten', 'error');
        }
      }
      
      showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        if (!notification) return;
        
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.add('show');
        
        // Auto-hide after 4 seconds
        setTimeout(() => {
          notification.classList.remove('show');
        }, 4000);
      }
      
      showError(message) {
        const container = document.getElementById('categories');
        if (container) {
          container.innerHTML = `
            <div class="error-state">
              <h3>‚ö†Ô∏è Fehler aufgetreten</h3>
              <p>${message}</p>
              <button class="btn primary" onclick="location.reload()">
                üîÑ Seite neu laden
              </button>
            </div>
          `;
        }
        console.error('Application error:', message);
      }
      
      // Cleanup method for proper resource management
      destroy() {
        if (this.autosaveInterval) {
          clearInterval(this.autosaveInterval);
        }
        if (this.updateTimeInterval) {
          clearInterval(this.updateTimeInterval);
        }
        
        // Remove event listeners
        document.removeEventListener('keydown', this.setupKeyboardNavigation);
      }
    }
    
    // Enhanced global functions with error handling
    window.exportPDF = function() {
      try {
        if (window.healthApp) {
          window.healthApp.exportData();
        } else {
          console.error('Health app not initialized');
        }
      } catch (error) {
        console.error('Export error:', error);
        alert('Fehler beim Exportieren der Daten');
      }
    };
    
    window.resetAll = function() {
      try {
        if (window.healthApp) {
          window.healthApp.resetData();
        } else {
          console.error('Health app not initialized');
        }
      } catch (error) {
        console.error('Reset error:', error);
        alert('Fehler beim Zur√ºcksetzen der Daten');
      }
    };
    
    // Initialize app when DOM is ready with error handling
    document.addEventListener('DOMContentLoaded', () => {
      try {
        window.healthApp = new HealthAssessment();
        
        // Add performance monitoring
        if ('performance' in window) {
          window.addEventListener('load', () => {
            const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
            console.log(`NH Score loaded in ${loadTime}ms`);
          });
        }
        
        // Add visibility change handling for better UX
        document.addEventListener('visibilitychange', () => {
          if (!document.hidden && window.healthApp) {
            // Refresh UI when user returns to tab
            window.healthApp.updateUI();
          }
        });
        
      } catch (error) {
        console.error('Failed to initialize health assessment:', error);
        
        // Fallback error display
        const container = document.getElementById('categories');
        if (container) {
          container.innerHTML = `
            <div class="error-state">
              <h3>‚ö†Ô∏è Anwendung konnte nicht geladen werden</h3>
              <p>Es ist ein technischer Fehler aufgetreten. Bitte laden Sie die Seite neu.</p>
              <button class="btn primary" onclick="location.reload()">
                üîÑ Seite neu laden
              </button>
            </div>
          `;
        }
      }
    });
    
    // Add beforeunload handler to prevent accidental data loss
    window.addEventListener('beforeunload', (e) => {
      if (window.healthApp) {
        const answeredQuestions = window.healthApp.answers.flat().filter(answer => answer !== null).length;
        if (answeredQuestions > 0) {
          // Save data before leaving
          window.healthApp.saveData();
          
          // Show warning for significant progress
          if (answeredQuestions > 10) {
            e.preventDefault();
            e.returnValue = 'Sie haben ungespeicherte √Ñnderungen. M√∂chten Sie die Seite wirklich verlassen?';
            return e.returnValue;
          }
        }
      }
    });
    
    // Service Worker registration for potential PWA features (optional)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Could be implemented for offline functionality
        console.log('Service Worker support detected');
      });
    }
  </script>
</body>
</html>
