<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="NH Score - Wissenschaftlich fundiertes Gesundheitsbewertungssystem" />
<title>NH SCORE – Professional Health Assessment</title>
<style>
  :root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --success: #10b981;
    --warning: #f59e0b;
    --error: #ef4444;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --gray-900: #111827;
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --text-primary: #f8fafc;
    --text-secondary: #cbd5e1;
    --border-color: rgba(148, 163, 184, 0.1);
    --glass-bg: rgba(30, 41, 59, 0.4);
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
  }

  /* Progress Header */
  .progress-header {
    position: sticky;
    top: 0;
    background: var(--glass-bg);
    backdrop-filter: blur(16px);
    border-bottom: 1px solid var(--border-color);
    z-index: 100;
    padding: 1rem 0;
    box-shadow: var(--shadow);
  }
  
  .progress-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }
  
  .progress-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
    min-width: 200px;
  }
  
  .progress-bar-container {
    flex: 1;
    max-width: 400px;
    height: 10px;
    background: var(--gray-800);
    border-radius: 5px;
    overflow: hidden;
  }
  
  .progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--success));
    border-radius: 5px;
    transition: width 0.4s ease;
    width: 0%;
  }

  .category-nav {
    display: flex;
    gap: 0.75rem;
    align-items: center;
  }
  
  .category-dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--gray-600);
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .category-dot.completed { 
    background: var(--success); 
    box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
  }
  .category-dot.active { 
    background: var(--primary); 
    transform: scale(1.3); 
  }
  .category-dot:hover { 
    transform: scale(1.2); 
  }

  .action-buttons {
    display: flex;
    gap: 0.75rem;
  }
  
  .btn {
    padding: 0.625rem 1.25rem;
    border: 1px solid var(--border-color);
    background: var(--glass-bg);
    color: var(--text-primary);
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.2s ease;
    backdrop-filter: blur(8px);
  }
  
  .btn:hover {
    background: var(--gray-700);
    border-color: var(--gray-600);
    transform: translateY(-1px);
  }
  
  .btn.primary {
    background: var(--primary);
    border-color: var(--primary);
  }
  
  .btn.primary:hover {
    background: var(--primary-dark);
  }

  .autosave-indicator {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 500;
  }
  
  .autosave-indicator.saving {
    color: var(--warning);
  }
  
  .autosave-indicator.saved {
    color: var(--success);
  }

  /* Main Layout */
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 2rem;
  }

  /* Score Panel */
  .score-panel {
    background: var(--glass-bg);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 2rem;
    backdrop-filter: blur(16px);
    height: fit-content;
    position: sticky;
    top: 140px;
    box-shadow: var(--shadow-lg);
  }
  
  .score-header h3 {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }
  
  .score-date {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 2rem;
  }
  
  .score-ring {
    position: relative;
    width: 140px;
    height: 140px;
    margin: 0 auto 1.5rem;
  }
  
  .score-circle {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    background: conic-gradient(var(--primary) 0deg, var(--gray-700) 0deg);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: all 0.5s ease;
  }
  
  .score-circle::before {
    content: '';
    width: 90px;
    height: 90px;
    background: var(--bg-secondary);
    border-radius: 50%;
    position: absolute;
  }
  
  .score-value {
    position: relative;
    z-index: 1;
    font-size: 1.75rem;
    font-weight: 700;
    text-align: center;
    line-height: 1.2;
  }
  
  .score-percentage {
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-weight: 500;
  }
  
  .score-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid var(--border-color);
  }
  
  .stat-item {
    text-align: center;
  }
  
  .stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--success);
    margin-bottom: 0.25rem;
  }
  
  .stat-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 500;
  }

  /* Hero Section */
  .hero-section {
    text-align: center;
    padding: 4rem 0 3rem;
    margin-bottom: 2rem;
    border-bottom: 1px solid var(--border-color);
  }
  
  .main-title {
    font-size: clamp(3rem, 8vw, 5rem);
    font-weight: 900;
    background: linear-gradient(135deg, var(--primary), #8b5cf6, #06b6d4);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1.5rem;
    animation: gradientShift 8s ease-in-out infinite;
    letter-spacing: -0.02em;
  }
  
  @keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  
  .subtitle {
    font-size: clamp(1.125rem, 3vw, 1.375rem);
    color: var(--text-secondary);
    max-width: 900px;
    margin: 0 auto;
    line-height: 1.6;
    font-weight: 400;
  }

  /* Categories */
  .categories {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }
  
  .category {
    background: var(--glass-bg);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 2rem;
    backdrop-filter: blur(16px);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .category::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--success));
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .category.active {
    border-color: var(--primary);
    box-shadow: 0 0 0 1px var(--primary);
    transform: translateY(-2px);
  }

  .category.active::before {
    opacity: 1;
  }
  
  .category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    gap: 1rem;
  }
  
  .category-title {
    font-size: 1.375rem;
    font-weight: 600;
    flex: 1;
  }
  
  .category-score {
    background: var(--gray-800);
    padding: 0.625rem 1.25rem;
    border-radius: 25px;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
  }
  
  .category-progress {
    width: 100%;
    height: 6px;
    background: var(--gray-800);
    border-radius: 3px;
    margin-bottom: 2rem;
    overflow: hidden;
  }
  
  .category-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--success));
    border-radius: 3px;
    transition: width 0.4s ease;
    width: 0%;
  }

  /* Questions */
  .question {
    margin-bottom: 2rem;
    padding: 1.5rem;
    border: 2px solid transparent;
    border-radius: 12px;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.01);
  }
  
  .question:hover {
    background: rgba(255, 255, 255, 0.03);
    border-color: var(--border-color);
  }
  
  .question.answered {
    border-color: var(--success);
    background: rgba(16, 185, 129, 0.05);
  }
  
  .question-label {
    display: block;
    margin-bottom: 1.25rem;
    font-weight: 500;
    font-size: 1.0625rem;
    line-height: 1.5;
  }
  
  .question-number {
    color: var(--primary);
    font-weight: 600;
    margin-right: 0.75rem;
    font-size: 0.875rem;
  }

  /* Radio Groups */
  .radio-group {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }
  
  .radio-option {
    position: relative;
  }
  
  .radio-option input {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }
  
  .radio-option label {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem 1.25rem;
    background: var(--gray-800);
    border: 2px solid var(--gray-700);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.9375rem;
    font-weight: 500;
    text-align: center;
    min-height: 52px;
  }
  
  .radio-option label:hover {
    border-color: var(--gray-600);
    background: var(--gray-700);
    transform: translateY(-1px);
  }
  
  .radio-option input:checked + label {
    border-color: var(--primary);
    background: rgba(99, 102, 241, 0.15);
    color: var(--primary);
    transform: translateY(-1px);
  }
  
  .radio-option:nth-child(1) input:checked + label {
    border-color: var(--error);
    background: rgba(239, 68, 68, 0.15);
    color: var(--error);
  }
  
  .radio-option:nth-child(2) input:checked + label {
    border-color: var(--warning);
    background: rgba(245, 158, 11, 0.15);
    color: var(--warning);
  }
  
  .radio-option:nth-child(3) input:checked + label {
    border-color: var(--success);
    background: rgba(16, 185, 129, 0.15);
    color: var(--success);
  }

  /* Final Assessment Modal */
  .assessment-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(8px);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s ease;
  }

  .assessment-modal.show {
    opacity: 1;
    visibility: visible;
  }

  .modal-content {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    padding: 3rem;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    transform: scale(0.9) translateY(20px);
    transition: all 0.4s ease;
  }

  .assessment-modal.show .modal-content {
    transform: scale(1) translateY(0);
  }

  .modal-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border-color);
  }

  .completion-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, var(--success), #059669);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 25px;
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: 1rem;
  }

  .final-score-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    margin: 2rem 0;
  }

  .final-score-circle {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    background: conic-gradient(var(--primary) 0deg, var(--gray-700) 0deg);
  }

  .final-score-circle::before {
    content: '';
    width: 80px;
    height: 80px;
    background: var(--bg-secondary);
    border-radius: 50%;
    position: absolute;
  }

  .final-score-text {
    position: relative;
    z-index: 1;
    text-align: center;
    font-weight: 700;
  }

  .final-score-number {
    font-size: 1.75rem;
    color: var(--text-primary);
  }

  .final-score-percentage {
    font-size: 0.875rem;
    color: var(--text-secondary);
  }

  .score-rating {
    text-align: center;
  }

  .rating-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .rating-excellent { color: var(--success); }
  .rating-very-good { color: #06b6d4; }
  .rating-good { color: var(--warning); }
  .rating-needs-improvement { color: #f97316; }
  .rating-critical { color: var(--error); }

  .rating-description {
    color: var(--text-secondary);
    font-size: 1rem;
  }

  .modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid var(--border-color);
  }

  .modal-btn {
    padding: 0.75rem 2rem;
    border: 1px solid var(--border-color);
    background: var(--glass-bg);
    color: var(--text-primary);
    border-radius: 10px;
    cursor: pointer;
    font-size: 0.9375rem;
    font-weight: 500;
    transition: all 0.2s ease;
    backdrop-filter: blur(8px);
  }

  .modal-btn:hover {
    background: var(--gray-700);
    border-color: var(--gray-600);
    transform: translateY(-1px);
  }

  .modal-btn.primary {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
  }

  .modal-btn.primary:hover {
    background: var(--primary-dark);
  }

  .close-modal {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all 0.2s ease;
  }

  .close-modal:hover {
    background: var(--gray-700);
    color: var(--text-primary);
  }

  /* Notifications */
  .notification {
    position: fixed;
    top: 1rem;
    right: 1rem;
    padding: 1rem 1.5rem;
    background: var(--success);
    color: white;
    border-radius: 10px;
    font-weight: 500;
    z-index: 1000;
    transform: translateX(100%);
    transition: transform 0.4s ease;
    box-shadow: var(--shadow-lg);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .notification.show {
    transform: translateX(0);
  }
  
  .notification.error {
    background: var(--error);
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .container {
      grid-template-columns: 1fr;
      gap: 1.5rem;
      padding: 1.5rem 1rem;
    }
    
    .score-panel {
      position: static;
      order: -1;
      top: auto;
    }
    
    .hero-section {
      padding: 2rem 0;
    }
  }
  
  @media (max-width: 768px) {
    .progress-content {
      flex-direction: column;
      gap: 1rem;
      align-items: stretch;
    }
    
    .progress-info {
      order: 1;
      min-width: auto;
      justify-content: center;
    }
    
    .progress-bar-container {
      order: 2;
      max-width: none;
    }
    
    .category-nav {
      order: 3;
      justify-content: center;
    }
    
    .action-buttons {
      order: 4;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .radio-group {
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }
    
    .hero-section {
      padding: 1.5rem 0;
    }
    
    .main-title {
      font-size: clamp(2rem, 10vw, 3rem);
    }
    
    .subtitle {
      font-size: clamp(0.9375rem, 4vw, 1.125rem);
      padding: 0 1rem;
    }
    
    .category {
      padding: 1.5rem;
      margin: 0 0.5rem;
    }
    
    .category-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.75rem;
    }
    
    .category-score {
      align-self: flex-end;
    }
    
    .container {
      padding: 1rem 0.5rem;
    }

    .score-panel {
      padding: 1.5rem;
      margin: 0 0.5rem;
    }

    .question {
      padding: 1.25rem;
    }

    .question-label {
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .radio-option label {
      padding: 0.875rem 1rem;
      font-size: 0.9375rem;
      min-height: 48px;
    }

    .final-score-display {
      flex-direction: column;
      gap: 1.5rem;
    }

    .modal-content {
      margin: 1rem;
      padding: 2rem 1.5rem;
      max-width: calc(100% - 2rem);
    }

    .modal-actions {
      flex-direction: column;
      gap: 0.75rem;
    }

    .modal-btn {
      width: 100%;
      padding: 0.875rem 1.5rem;
    }

    .score-stats {
      gap: 1rem;
    }

    .stat-value {
      font-size: 1.25rem;
    }

    .autosave-indicator {
      font-size: 0.75rem;
    }

    .btn {
      padding: 0.75rem 1rem;
      font-size: 0.8125rem;
    }
  }

  @media (max-width: 480px) {
    .progress-header {
      padding: 0.75rem 0;
    }

    .container {
      padding: 0.75rem 0.25rem;
    }

    .hero-section {
      padding: 1rem 0;
      margin-bottom: 1.5rem;
    }

    .category {
      padding: 1.25rem;
      margin: 0 0.25rem;
    }

    .score-panel {
      padding: 1.25rem;
      margin: 0 0.25rem;
    }

    .question {
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .radio-option label {
      padding: 0.75rem 0.875rem;
      font-size: 0.875rem;
      min-height: 44px;
    }

    .modal-content {
      padding: 1.5rem 1rem;
    }

    .score-ring {
      width: 120px;
      height: 120px;
    }

    .score-circle {
      width: 120px;
      height: 120px;
    }

    .score-circle::before {
      width: 80px;
      height: 80px;
    }

    .score-value {
      font-size: 1.5rem;
    }

    .category-nav {
      gap: 0.5rem;
    }
  }
</style>
</head>
<body>
  <div class="progress-header">
    <div class="progress-content">
      <div class="progress-info">
        <span id="progressText">Frage 0 von 50</span>
        <div class="autosave-indicator" id="autosaveIndicator">
          <span>●</span>
          <span>Automatisch gespeichert</span>
        </div>
      </div>
      
      <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      
      <div class="category-nav" id="categoryNav"></div>
      
      <div class="action-buttons">
        <button class="btn" onclick="window.exportPDF()" title="Als PDF exportieren">
          Export
        </button>
        <button class="btn primary" onclick="window.resetAll()" title="Alle Antworten zurücksetzen">
          Reset
        </button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="main-content">
      <!-- Hero Section -->
      <header class="hero-section">
        <h1 class="main-title">NH Score</h1>
        <p class="subtitle">Wissenschaftlich fundiertes 100-Punkte-System für umfassende Gesundheit & Leistungsfähigkeit</p>
      </header>

      <main class="categories" id="categories"></main>
    </div>
    
    <aside class="score-panel">
      <div class="score-header">
        <h3>Gesundheitsscore</h3>
        <div class="score-date" id="scoreDate"></div>
      </div>
      
      <div class="score-ring">
        <div class="score-circle" id="scoreCircle">
          <div class="score-value">
            <div id="totalScore">0</div>
            <div class="score-percentage" id="scorePercentage">0%</div>
          </div>
        </div>
      </div>
      
      <div class="score-stats">
        <div class="stat-item">
          <div class="stat-value" id="answeredCount">0</div>
          <div class="stat-label">Beantwortet</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="completedCategories">0</div>
          <div class="stat-label">Kategorien</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="averageScore">0%</div>
          <div class="stat-label">Durchschnitt</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="timeSpent">0m</div>
          <div class="stat-label">Zeit</div>
        </div>
      </div>
    </aside>
  </div>

  <div class="notification" id="notification"></div>

  <!-- Final Assessment Modal -->
  <div class="assessment-modal" id="assessmentModal">
    <div class="modal-content">
      <button class="close-modal" onclick="window.healthApp.closeFinalAssessment()">×</button>
      
      <div class="modal-header">
        <div class="completion-badge">
          <span>✓</span>
          <span>Assessment abgeschlossen</span>
        </div>
        <h2>Ihre persönliche Gesundheitsauswertung</h2>
      </div>

      <div class="final-score-display">
        <div class="final-score-circle" id="finalScoreCircle">
          <div class="final-score-text">
            <div class="final-score-number" id="finalScoreNumber">0</div>
            <div class="final-score-percentage" id="finalScorePercentage">0%</div>
          </div>
        </div>
        
        <div class="score-rating">
          <div class="rating-title" id="ratingTitle">Bewertung</div>
          <div class="rating-description" id="ratingDescription">Beschreibung</div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="modal-btn" onclick="window.healthApp.closeFinalAssessment()">
          Schließen
        </button>
        <button class="modal-btn primary" onclick="window.exportPDF(); window.healthApp.closeFinalAssessment();">
          PDF herunterladen
        </button>
      </div>
    </div>
  </div>

  <script>
    // Clean Health Assessment Implementation
    class HealthAssessment {
      constructor() {
        this.categories = [
          {
            title: 'Schlaf & Erholung',
            questions: [
              'Schläfst du mindestens 7–8 Stunden pro Nacht?',
              'Hast du einen regelmäßigen Schlaf-Wach-Rhythmus?',
              'Wachst du ohne Wecker erholt auf?',
              'Schläfst du ohne Unterbrechungen durch?',
              'Vermeidest du Blaulicht 2h vor dem Schlafengehen?',
              'Schläfst du in einem völlig dunklen Raum?',
              'Wachst du erfrischt und energiegeladen auf?',
              'Vermeidest du späte und schwere Mahlzeiten?',
              'Kommst du ohne Schlafmittel oder Alkohol aus?',
              'Fühlst du dich tagsüber wach und konzentriert?'
            ]
          },
          {
            title: 'Ernährung & Supplements',
            questions: [
              'Verzichtest du weitgehend auf raffinierten Zucker?',
              'Isst du täglich mindestens 5 Portionen Gemüse/Obst?',
              'Trinkst du täglich 2-3 Liter reines Wasser?',
              'Verwendest du Supplements gezielt nach Bedarf?',
              'Hast du regelmäßige und bewusste Essenszeiten?',
              'Isst du ballaststoffreich und nährstoffdicht?',
              'Vermeidest du hochverarbeitete Fertigprodukte?',
              'Meidest du künstliche Zusätze und Konservierungsstoffe?',
              'Hast du eine gesunde Verdauung ohne Probleme?',
              'Verzichtest du auf künstliche Süßstoffe?'
            ]
          },
          {
            title: 'Training & Bewegung',
            questions: [
              'Bewegst du dich täglich mindestens 30 Minuten?',
              'Trainierst du 3-4x pro Woche strukturiert?',
              'Schaffst du problemlos 10.000 Schritte täglich?',
              'Bist du schmerzfrei und beweglich?',
              'Hast du klare sportliche Ziele und Motivation?',
              'Folgst du einem durchdachten Trainingsplan?',
              'Trainierst du regelmäßig deine Ausdauer?',
              'Trainierst du systematisch deine Kraft?',
              'Bist du flexibel und hast gute Mobilität?',
              'Kannst du problemlos länger laufen/gehen?'
            ]
          },
          {
            title: 'Mindset & Stressmanagement',
            questions: [
              'Fühlst du dich selten überwältigt oder gestresst?',
              'Praktizierst du regelmäßig Meditation oder Achtsamkeit?',
              'Umgibst du dich mit positiven Einflüssen?',
              'Hast du klare Lebensziele und Prioritäten?',
              'Lebst du nach deinen persönlichen Werten?',
              'Hast du eine grundsätzlich optimistische Einstellung?',
              'Vermeidest du Multitasking und Ablenkungen?',
              'Hast du starke soziale Verbindungen und Unterstützung?',
              'Kannst du nach der Arbeit wirklich abschalten?',
              'Fühlst du dich meistens glücklich und erfüllt?'
            ]
          },
          {
            title: 'Lifestyle & Umwelt',
            questions: [
              'Rauchst du nicht und meidest Passivrauchen?',
              'Trinkst du maximal 1-2 Gläser Alkohol pro Woche?',
              'Vermeidest du Plastik bei Lebensmitteln und Getränken?',
              'Hast du Zugang zu sauberem, gefiltertem Wasser?',
              'Meidest du schädliche Chemikalien im Alltag?',
              'Verwendest du natürliche Körperpflege ohne Toxine?',
              'Schläfst du in einem schadstofffreien Umfeld?',
              'Bekommst du täglich natürliches Tageslicht?',
              'Verbringst du regelmäßig Zeit in der Natur?',
              'Führst du einen bewusst nachhaltigen Lebensstil?'
            ]
          }
        ];
        
        this.answers = this.loadData() || this.initializeAnswers();
        this.startTime = Date.now();
        this.autosaveInterval = null;
        this.updateTimeInterval = null;
        
        this.init();
      }
      
      initializeAnswers() {
        return this.categories.map(cat => new Array(cat.questions.length).fill(null));
      }
      
      init() {
        try {
          this.renderCategories();
          this.renderCategoryNav();
          this.updateUI();
          this.setupKeyboardNavigation();
          this.startAutosave();
          this.updateTimeSpent();
        } catch (error) {
          console.error('Initialization error:', error);
          this.showNotification('Fehler beim Laden der Anwendung', 'error');
        }
      }
      
      renderCategories() {
        const container = document.getElementById('categories');
        if (!container) return;
        
        container.innerHTML = '';
        
        this.categories.forEach((category, catIdx) => {
          const categoryEl = this.createCategoryElement(category, catIdx);
          container.appendChild(categoryEl);
        });
      }
      
      createCategoryElement(category, catIdx) {
        const categoryEl = document.createElement('section');
        categoryEl.className = 'category';
        categoryEl.id = `category-${catIdx}`;
        
        categoryEl.innerHTML = `
          <div class="category-header">
            <h2 class="category-title">${category.title}</h2>
            <div class="category-score" id="score-${catIdx}">0 / 20</div>
          </div>
          <div class="category-progress">
            <div class="category-progress-fill" id="progress-${catIdx}"></div>
          </div>
          <div class="questions">
            ${category.questions.map((question, qIdx) => 
              this.createQuestionHTML(question, catIdx, qIdx)
            ).join('')}
          </div>
        `;
        
        return categoryEl;
      }
      
      createQuestionHTML(question, catIdx, qIdx) {
        const isAnswered = this.answers[catIdx][qIdx] !== null;
        const fieldsetId = `cat${catIdx}_q${qIdx}`;
        
        return `
          <div class="question ${isAnswered ? 'answered' : ''}" id="question-${catIdx}-${qIdx}">
            <label class="question-label">
              <span class="question-number">${qIdx + 1}.</span>
              ${question}
            </label>
            <div class="radio-group">
              ${['Nein', 'Teilweise', 'Ja'].map((text, val) => `
                <div class="radio-option">
                  <input type="radio" 
                         name="${fieldsetId}" 
                         value="${val}" 
                         id="${fieldsetId}_v${val}"
                         ${this.answers[catIdx][qIdx] === val ? 'checked' : ''}
                         onchange="window.healthApp.handleAnswer(${catIdx}, ${qIdx}, ${val})">
                  <label for="${fieldsetId}_v${val}">${text}</label>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      
      renderCategoryNav() {
        const nav = document.getElementById('categoryNav');
        if (!nav) return;
        
        nav.innerHTML = '';
        
        this.categories.forEach((cat, idx) => {
          const dot = document.createElement('div');
          dot.className = 'category-dot';
          dot.title = cat.title;
          dot.onclick = () => this.scrollToCategory(idx);
          nav.appendChild(dot);
        });
      }
      
      handleAnswer(catIdx, qIdx, value) {
        try {
          this.answers[catIdx][qIdx] = parseInt(value);
          
          const questionEl = document.getElementById(`question-${catIdx}-${qIdx}`);
          if (questionEl) {
            questionEl.classList.add('answered');
          }
          
          this.updateUI();
          this.saveData();
          this.showAutosaveIndicator('saving');
          
          setTimeout(() => this.focusNextQuestion(catIdx, qIdx), 150);
          
        } catch (error) {
          console.error('Answer handling error:', error);
          this.showNotification('Fehler beim Speichern der Antwort', 'error');
        }
      }
      
      focusNextQuestion(catIdx, qIdx) {
        for (let c = catIdx; c < this.categories.length; c++) {
          const startQ = (c === catIdx) ? qIdx + 1 : 0;
          for (let q = startQ; q < this.categories[c].questions.length; q++) {
            if (this.answers[c][q] === null) {
              const nextQuestion = document.getElementById(`question-${c}-${q}`);
              if (nextQuestion) {
                nextQuestion.scrollIntoView({ 
                  behavior: 'smooth', 
                  block: 'center'
                });
                
                setTimeout(() => {
                  const firstRadio = nextQuestion.querySelector('input[type="radio"]');
                  if (firstRadio) firstRadio.focus();
                }, 300);
              }
              return;
            }
          }
        }
        
        if (this.isAssessmentComplete()) {
          setTimeout(() => this.showFinalAssessment(), 1000);
        }
      }
      
      isAssessmentComplete() {
        const totalQuestions = this.categories.reduce((sum, cat) => sum + cat.questions.length, 0);
        const answeredQuestions = this.answers.flat().filter(answer => answer !== null).length;
        return answeredQuestions === totalQuestions;
      }
      
      updateUI() {
        try {
          this.updateProgress();
          this.updateScorePanel();
          this.updateCategoryNav();
          this.updateCategoryStates();
        } catch (error) {
          console.error('UI update error:', error);
        }
      }
      
      updateProgress() {
        const totalQuestions = this.categories.reduce((sum, cat) => sum + cat.questions.length, 0);
        const answeredQuestions = this.answers.flat().filter(answer => answer !== null).length;
        const progress = totalQuestions > 0 ? (answeredQuestions / totalQuestions) * 100 : 0;
        
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        
        if (progressBar) {
          progressBar.style.width = `${progress}%`;
        }
        
        if (progressText) {
          progressText.textContent = `Frage ${answeredQuestions} von ${totalQuestions}`;
        }
      }
      
      updateScorePanel() {
        const totalScore = this.calculateTotalScore();
        const maxScore = 100;
        const percentage = Math.round((totalScore / maxScore) * 100);
        const answeredCount = this.answers.flat().filter(answer => answer !== null).length;
        const totalQuestions = this.categories.reduce((sum, cat) => sum + cat.questions.length, 0);
        const completedCategories = this.answers.filter(catAnswers => 
          catAnswers.every(answer => answer !== null)
        ).length;
        
        const scoreCircle = document.getElementById('scoreCircle');
        if (scoreCircle) {
          const degrees = (percentage / 100) * 360;
          scoreCircle.style.background = `conic-gradient(var(--primary) ${degrees}deg, var(--gray-700) ${degrees}deg)`;
        }
        
        this.updateElementText('totalScore', totalScore);
        this.updateElementText('scorePercentage', `${percentage}%`);
        this.updateElementText('answeredCount', `${answeredCount}/${totalQuestions}`);
        this.updateElementText('completedCategories', `${completedCategories}/5`);
        this.updateElementText('averageScore', `${percentage}%`);
        this.updateElementText('scoreDate', `Stand: ${new Date().toLocaleDateString('de-DE')}`);
      }
      
      updateElementText(id, text) {
        const element = document.getElementById(id);
        if (element) element.textContent = text;
      }
      
      updateCategoryNav() {
        const dots = document.querySelectorAll('.category-dot');
        this.answers.forEach((categoryAnswers, idx) => {
          if (dots[idx]) {
            const isCompleted = categoryAnswers.every(answer => answer !== null);
            const hasAnswers = categoryAnswers.some(answer => answer !== null);
            
            dots[idx].classList.toggle('completed', isCompleted);
            dots[idx].classList.toggle('active', hasAnswers && !isCompleted);
          }
        });
      }
      
      updateCategoryStates() {
        this.categories.forEach((category, catIdx) => {
          const categoryAnswers = this.answers[catIdx];
          const answered = categoryAnswers.filter(answer => answer !== null).length;
          const score = categoryAnswers.reduce((sum, answer) => sum + (answer || 0), 0);
          const progress = category.questions.length > 0 ? (answered / category.questions.length) * 100 : 0;
          
          const scoreEl = document.getElementById(`score-${catIdx}`);
          const progressEl = document.getElementById(`progress-${catIdx}`);
          const categoryEl = document.getElementById(`category-${catIdx}`);
          
          if (scoreEl) {
            scoreEl.textContent = `${score} / 20`;
          }
          
          if (progressEl) {
            progressEl.style.width = `${progress}%`;
          }
          
          if (categoryEl) {
            const isCompleted = answered === category.questions.length;
            categoryEl.classList.toggle('active', answered > 0 && !isCompleted);
          }
        });
      }
      
      calculateTotalScore() {
        return this.answers.flat().reduce((sum, answer) => sum + (answer || 0), 0);
      }
      
      scrollToCategory(index) {
        const categoryEl = document.getElementById(`category-${index}`);
        if (categoryEl) {
          categoryEl.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start'
          });
        }
      }
      
      setupKeyboardNavigation() {
        document.addEventListener('keydown', (e) => {
          if (e.target.type === 'radio') {
            const name = e.target.name;
            const radios = document.querySelectorAll(`input[name="${name}"]`);
            const currentIndex = Array.from(radios).indexOf(e.target);
            
            switch(e.key) {
              case 'ArrowLeft':
              case 'ArrowUp':
                e.preventDefault();
                if (currentIndex > 0) radios[currentIndex - 1].focus();
                break;
              case 'ArrowRight':
              case 'ArrowDown':
                e.preventDefault();
                if (currentIndex < radios.length - 1) radios[currentIndex + 1].focus();
                break;
              case 'Enter':
              case ' ':
                e.preventDefault();
                e.target.checked = true;
                e.target.onchange();
                break;
            }
          }
          
          if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
              case 's':
                e.preventDefault();
                this.exportData();
                break;
              case 'r':
                e.preventDefault();
                if (confirm('Alle Daten zurücksetzen?')) {
                  this.resetData();
                }
                break;
            }
          }
        });
      }
      
      startAutosave() {
        if (this.autosaveInterval) {
          clearInterval(this.autosaveInterval);
        }
        
        this.autosaveInterval = setInterval(() => {
          this.saveData();
          this.showAutosaveIndicator('saved');
        }, 30000);
      }
      
      updateTimeSpent() {
        if (this.updateTimeInterval) {
          clearInterval(this.updateTimeInterval);
        }
        
        this.updateTimeInterval = setInterval(() => {
          const elapsed = Math.floor((Date.now() - this.startTime) / 60000);
          this.updateElementText('timeSpent', `${elapsed}m`);
        }, 60000);
      }
      
      showAutosaveIndicator(state) {
        const indicator = document.getElementById('autosaveIndicator');
        if (!indicator) return;
        
        indicator.className = `autosave-indicator ${state}`;
        
        if (state === 'saving') {
          indicator.innerHTML = '<span>●</span><span>Speichere...</span>';
          setTimeout(() => this.showAutosaveIndicator('saved'), 1000);
        } else if (state === 'saved') {
          indicator.innerHTML = '<span>●</span><span>Automatisch gespeichert</span>';
        }
      }
      
      saveData() {
        try {
          const data = {
            answers: this.answers,
            timestamp: Date.now(),
            version: '3.1',
            startTime: this.startTime
          };
          localStorage.setItem('nh-score-data', JSON.stringify(data));
        } catch (error) {
          console.error('Save error:', error);
          this.showNotification('Fehler beim Speichern', 'error');
        }
      }
      
      loadData() {
        try {
          const saved = localStorage.getItem('nh-score-data');
          if (saved) {
            const data = JSON.parse(saved);
            if (this.validateDataStructure(data)) {
              this.startTime = data.startTime || Date.now();
              return data.answers;
            }
          }
        } catch (e) {
          console.warn('Failed to load saved data:', e);
        }
        return null;
      }
      
      validateDataStructure(data) {
        if (!data || !data.answers || !Array.isArray(data.answers)) {
          return false;
        }
        
        if (data.answers.length !== this.categories.length) {
          return false;
        }
        
        return data.answers.every((catAnswers, idx) => 
          Array.isArray(catAnswers) && 
          catAnswers.length === this.categories[idx].questions.length
        );
      }

      showFinalAssessment() {
        const modal = document.getElementById('assessmentModal');
        if (!modal) return;
        
        const totalScore = this.calculateTotalScore();
        const percentage = Math.round((totalScore / 100) * 100);
        
        const scoreCircle = document.getElementById('finalScoreCircle');
        const scoreNumber = document.getElementById('finalScoreNumber');
        const scorePercentage = document.getElementById('finalScorePercentage');
        
        if (scoreCircle && scoreNumber && scorePercentage) {
          const degrees = (percentage / 100) * 360;
          scoreCircle.style.background = `conic-gradient(var(--primary) ${degrees}deg, var(--gray-700) ${degrees}deg)`;
          scoreNumber.textContent = totalScore;
          scorePercentage.textContent = `${percentage}%`;
        }
        
        this.updateFinalRating(percentage);
        
        modal.classList.add('show');
        document.body.style.overflow = 'hidden';
      }
      
      updateFinalRating(percentage) {
        const ratingTitle = document.getElementById('ratingTitle');
        const ratingDescription = document.getElementById('ratingDescription');
        
        if (!ratingTitle || !ratingDescription) return;
        
        let rating, description, className;
        
        if (percentage >= 85) {
          rating = 'Ausgezeichnet';
          description = 'Sie haben einen vorbildlichen Gesundheitsstatus erreicht.';
          className = 'rating-excellent';
        } else if (percentage >= 70) {
          rating = 'Sehr gut';
          description = 'Sie haben eine solide Gesundheitsbasis.';
          className = 'rating-very-good';
        } else if (percentage >= 55) {
          rating = 'Gut';
          description = 'Sie sind auf dem richtigen Weg.';
          className = 'rating-good';
        } else if (percentage >= 40) {
          rating = 'Verbesserungswürdig';
          description = 'Ihre Gesundheit hat Optimierungspotential.';
          className = 'rating-needs-improvement';
        } else {
          rating = 'Handlungsbedarf';
          description = 'Ihre Gesundheit benötigt dringende Aufmerksamkeit.';
          className = 'rating-critical';
        }
        
        ratingTitle.textContent = rating;
        ratingTitle.className = `rating-title ${className}`;
        ratingDescription.textContent = description;
      }
      
      closeFinalAssessment() {
        const modal = document.getElementById('assessmentModal');
        if (modal) {
          modal.classList.remove('show');
          document.body.style.overflow = '';
        }
      }
      
      exportData() {
        try {
          const totalScore = this.calculateTotalScore();
          const percentage = Math.round((totalScore / 100) * 100);
          const date = new Date().toLocaleDateString('de-DE');
          const time = new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
          const answeredQuestions = this.answers.flat().filter(answer => answer !== null).length;
          const totalQuestions = this.categories.reduce((sum, cat) => sum + cat.questions.length, 0);
          
          const categoryBreakdown = this.categories.map((cat, idx) => {
            const score = this.answers[idx].reduce((sum, answer) => sum + (answer || 0), 0);
            const answered = this.answers[idx].filter(answer => answer !== null).length;
            const catPercentage = answered > 0 ? Math.round((score / (cat.questions.length * 2)) * 100) : 0;
            
            let statusIcon = '';
            let statusColor = '';
            if (catPercentage >= 80) { statusIcon = '●'; statusColor = '#10b981'; }
            else if (catPercentage >= 65) { statusIcon = '●'; statusColor = '#3b82f6'; }
            else if (catPercentage >= 50) { statusIcon = '●'; statusColor = '#f59e0b'; }
            else if (catPercentage >= 35) { statusIcon = '●'; statusColor = '#f97316'; }
            else { statusIcon = '●'; statusColor = '#ef4444'; }
            
            return `<tr>
              <td style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb; font-weight: 500; color: #374151;">${cat.title}</td>
              <td style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb; text-align: center; font-weight: 600; color: #1f2937;">${score}/20</td>
              <td style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb; text-align: center; font-weight: 600; color: #1f2937;">${catPercentage}%</td>
              <td style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb; text-align: center; color: #6b7280;">${answered}/${cat.questions.length}</td>
              <td style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb; text-align: center;"><span style="color: ${statusColor}; font-size: 14px;">${statusIcon}</span></td>
            </tr>`;
          }).join('');

          const getRating = (perc) => {
            if (perc >= 85) return { rating: 'AUSGEZEICHNET', color: '#10b981', icon: '▲' };
            if (perc >= 70) return { rating: 'SEHR GUT', color: '#3b82f6', icon: '▲' };
            if (perc >= 55) return { rating: 'GUT', color: '#f59e0b', icon: '■' };
            if (perc >= 40) return { rating: 'VERBESSERUNG', color: '#f97316', icon: '▼' };
            return { rating: 'HANDLUNGSBEDARF', color: '#ef4444', icon: '▼' };
          };

          const ratingInfo = getRating(percentage);
          
          const printWindow = window.open('', '_blank');
          const htmlContent = `<!DOCTYPE html>
<html lang="de">
<head>
  <title>NH Score Health Assessment Report</title>
  <meta charset="UTF-8">
  <style>
    @page { size: A4; margin: 20mm; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.4; color: #1f2937; background: #ffffff; font-size: 11px;
    }
    .page { width: 210mm; min-height: 297mm; margin: 0 auto; background: white; display: flex; flex-direction: column; }
    .header { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white; padding: 20px; margin-bottom: 25px; }
    .header-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
    .logo-section h1 { font-size: 28px; font-weight: 700; letter-spacing: 1px; margin-bottom: 4px; }
    .logo-section .tagline { font-size: 11px; opacity: 0.8; font-weight: 400; }
    .meta-data { text-align: right; font-size: 10px; opacity: 0.9; }
    .meta-data div { margin-bottom: 2px; }
    .score-section { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; }
    .score-display { display: flex; align-items: center; gap: 25px; }
    .score-circle { width: 80px; height: 80px; border-radius: 50%; background: conic-gradient(#6366f1 ${(percentage/100)*360}deg, rgba(255,255,255,0.3) ${(percentage/100)*360}deg); display: flex; align-items: center; justify-content: center; position: relative; }
    .score-circle::before { content: ''; width: 60px; height: 60px; background: #1e293b; border-radius: 50%; position: absolute; }
    .score-text { position: relative; z-index: 1; text-align: center; color: white; }
    .score-number { font-size: 20px; font-weight: 700; line-height: 1; }
    .score-percentage { font-size: 10px; opacity: 0.8; }
    .score-info h2 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
    .score-rating { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: ${ratingInfo.color}; }
    .content { flex: 1; padding: 0 20px; }
    .metrics-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
    .metric-card { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 15px 12px; text-align: center; }
    .metric-value { font-size: 18px; font-weight: 700; color: #1e293b; margin-bottom: 4px; }
    .metric-label { font-size: 9px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 500; }
    .section-title { font-size: 14px; font-weight: 600; color: #1e293b; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #e2e8f0; display: flex; align-items: center; gap: 8px; }
    .section-icon { width: 16px; height: 16px; background: #6366f1; border-radius: 3px; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: 600; }
    .category-table { width: 100%; border-collapse: collapse; background: white; border: 1px solid #e5e7eb; border-radius: 6px; overflow: hidden; margin-bottom: 20px; }
    .category-table th { background: #f1f5f9; color: #374151; padding: 10px 12px; font-weight: 600; font-size: 10px; text-align: left; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid #e5e7eb; }
    .category-table th:nth-child(2), .category-table th:nth-child(3), .category-table th:nth-child(4), .category-table th:nth-child(5) { text-align: center; }
    .category-table tr:nth-child(even) { background: #fafbfc; }
    .footer { margin-top: auto; padding: 15px 20px; border-top: 1px solid #e5e7eb; background: #f8fafc; display: flex; justify-content: space-between; align-items: center; font-size: 9px; color: #6b7280; }
    .footer-left { font-weight: 500; }
    .footer-right { text-align: right; }
    .legend { display: flex; gap: 15px; justify-content: center; margin-top: 15px; padding: 10px; background: #f8fafc; border-radius: 4px; font-size: 9px; }
    .legend-item { display: flex; align-items: center; gap: 4px; color: #6b7280; }
    @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } .page { margin: 0; box-shadow: none; } }
  </style>
</head>
<body>
  <div class="page">
    <div class="header">
      <div class="header-top">
        <div class="logo-section">
          <h1>NH SCORE</h1>
          <div class="tagline">Professional Health Assessment Report</div>
        </div>
        <div class="meta-data">
          <div>Report ID: NHS-${Date.now().toString().slice(-6)}</div>
          <div>Generated: ${date} ${time}</div>
          <div>Version: 3.1</div>
          <div>Status: Confidential</div>
        </div>
      </div>
      <div class="score-section">
        <div class="score-display">
          <div class="score-circle">
            <div class="score-text">
              <div class="score-number">${totalScore}</div>
              <div class="score-percentage">${percentage}%</div>
            </div>
          </div>
          <div class="score-info">
            <h2>Gesamt-Gesundheitsscore</h2>
            <div class="score-rating">
              <span>${ratingInfo.icon}</span>
              <span>${ratingInfo.rating}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="content">
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-value">${totalScore}/100</div>
          <div class="metric-label">Gesamtpunkte</div>
        </div>
        <div class="metric-card">
          <div class="metric-value">${answeredQuestions}/${totalQuestions}</div>
          <div class="metric-label">Fragen beantwortet</div>
        </div>
        <div class="metric-card">
          <div class="metric-value">${this.answers.filter(cat => cat.every(a => a !== null)).length}/5</div>
          <div class="metric-label">Kategorien komplett</div>
        </div>
        <div class="metric-card">
          <div class="metric-value">${percentage}%</div>
          <div class="metric-label">Effektivität</div>
        </div>
      </div>
      <h3 class="section-title">
        <div class="section-icon">📊</div>
        Detailanalyse nach Gesundheitsbereichen
      </h3>
      <table class="category-table">
        <thead>
          <tr>
            <th>Gesundheitsbereich</th>
            <th>Punkte</th>
            <th>Prozent</th>
            <th>Vollständigkeit</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          ${categoryBreakdown}
        </tbody>
      </table>
      <div class="legend">
        <div class="legend-item"><span style="color: #10b981;">●</span><span>≥80% Ausgezeichnet</span></div>
        <div class="legend-item"><span style="color: #3b82f6;">●</span><span>≥65% Sehr gut</span></div>
        <div class="legend-item"><span style="color: #f59e0b;">●</span><span>≥50% Gut</span></div>
        <div class="legend-item"><span style="color: #f97316;">●</span><span>≥35% Verbesserung</span></div>
        <div class="legend-item"><span style="color: #ef4444;">●</span><span><35% Handlungsbedarf</span></div>
      </div>
    </div>
    <div class="footer">
      <div class="footer-left"><strong>NH Score</strong> - Wissenschaftlich fundiertes Gesundheitsbewertungssystem</div>
      <div class="footer-right">Erstellt am ${date} um ${time}<br>Dieses Dokument ist vertraulich und ausschließlich für den Empfänger bestimmt.</div>
    </div>
  </div>
</body>
</html>`;
          
          printWindow.document.write(htmlContent);
          printWindow.document.close();
          
          setTimeout(() => {
            printWindow.print();
          }, 1000);
          
          printWindow.document.write(htmlContent);
          printWindow.document.close();
          
          setTimeout(() => {
            printWindow.print();
          }, 1000);
          
          this.showNotification('PDF wird erstellt...', 'success');
          
        } catch (error) {
          console.error('Export error:', error);
          this.showNotification('Fehler beim Exportieren', 'error');
        }
      }>
                    <div class="legend-item">
                      <span style="color: #f59e0b;">●</span>
                      <span>≥50% Gut</span>
                    </div>
                    <div class="legend-item">
                      <span style="color: #f97316;">●</span>
                      <span>≥35% Verbesserung</span>
                    </div>
                    <div class="legend-item">
                      <span style="color: #ef4444;">●</span>
                      <span><35% Handlungsbedarf</span>
                    </div>
                  </div>
                </div>
                
                <div class="footer">
                  <div class="footer-left">
                    <strong>NH Score</strong> - Wissenschaftlich fundiertes Gesundheitsbewertungssystem
                  </div>
                  <div class="footer-right">
                    Erstellt am ${date} um ${time}<br>
                    Dieses Dokument ist vertraulich und ausschließlich für den Empfänger bestimmt.
                  </div>
                </div>
              </div>
            </body>
            </html>
          `);
          printWindow.document.close();
          
          setTimeout(() => {
            printWindow.print();
          }, 1000);
          
          this.showNotification('PDF wird erstellt...', 'success');
          
        } catch (error) {
          console.error('Export error:', error);
          this.showNotification('Fehler beim Exportieren', 'error');
        }
      };
                  }
                  
                  .summary-grid {
                    grid-template-columns: 1fr;
                  }
                  
                  .main-title {
                    font-size: 2rem;
                  }
                }
              </style>
            </head>
            <body>
              <div class="container">
                <div class="header">
                  <div class="logo-area">
                    <h1 class="main-title">NH SCORE</h1>
                    <p class="subtitle">Professional Health Assessment Report</p>
                  </div>
                  
                  <div class="meta-info">
                    <div class="meta-item">📅 ${date}</div>
                    <div class="meta-item">🕐 ${time}</div>
                    <div class="meta-item">📊 Version 3.1</div>
                  </div>
                  
                  <div class="score-container">
                    <div class="score-circle">
                      <div class="score-text">
                        <div class="score-number">${totalScore}</div>
                        <div class="score-percentage">${percentage}%</div>
                      </div>
                    </div>
                    
                    <div class="score-info">
                      <div class="overall-rating">${ratingInfo.rating}</div>
                      <div class="rating-description">${ratingInfo.description}</div>
                    </div>
                  </div>
                </div>
                
                <div class="summary-section">
                  <h2 class="summary-title">📈 Übersicht</h2>
                  <div class="summary-grid">
                    <div class="summary-item">
                      <div class="summary-value">${totalScore}/100</div>
                      <div class="summary-label">Gesamtpunkte</div>
                    </div>
                    <div class="summary-item">
                      <div class="summary-value">${answeredQuestions}/${totalQuestions}</div>
                      <div class="summary-label">Fragen beantwortet</div>
                    </div>
                    <div class="summary-item">
                      <div class="summary-value">${this.answers.filter(cat => cat.every(a => a !== null)).length}/5</div>
                      <div class="summary-label">Kategorien abgeschlossen</div>
                    </div>
                    <div class="summary-item">
                      <div class="summary-value">${percentage}%</div>
                      <div class="summary-label">Gesundheitsscore</div>
                    </div>
                  </div>
                </div>
                
                <div class="breakdown-section">
                  <h2 class="section-title">📋 Kategorien-Auswertung</h2>
                  <table class="category-table">
                    <thead>
                      <tr>
                        <th>Gesundheitsbereich</th>
                        <th>Punkte</th>
                        <th>Prozent</th>
                        <th>Vollständigkeit</th>
                        <th>Bewertung</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${categoryBreakdown}
                    </tbody>
                  </table>
                </div>
                
                <div class="footer">
                  <div class="footer-title">NH Score - Professional Health Assessment</div>
                  <div class="footer-subtitle">Wissenschaftlich fundiertes 100-Punkte-System für umfassende Gesundheit</div>
                  <div class="footer-meta">
                    Generiert am ${date} um ${time} | Vertraulich
                  </div>
                </div>
              </div>
            </body>
            </html>
          `);
          printWindow.document.close();
          
          setTimeout(() => {
            printWindow.print();
          }, 800);
          
          this.showNotification('PDF wird erstellt...', 'success');
          
        } catch (error) {
          console.error('Export error:', error);
          this.showNotification('Fehler beim Exportieren', 'error');
        }
      }
      
      resetData() {
        if (!confirm('Möchten Sie wirklich alle Antworten zurücksetzen? Diese Aktion kann nicht rückgängig gemacht werden.')) {
          return;
        }
        
        try {
          this.answers = this.initializeAnswers();
          this.startTime = Date.now();
          
          localStorage.removeItem('nh-score-data');
          
          if (this.autosaveInterval) {
            clearInterval(this.autosaveInterval);
          }
          if (this.updateTimeInterval) {
            clearInterval(this.updateTimeInterval);
          }
          
          this.renderCategories();
          this.renderCategoryNav();
          this.updateUI();
          
          this.startAutosave();
          this.updateTimeSpent();
          
          this.showNotification('Alle Daten wurden erfolgreich zurückgesetzt', 'success');
          
          window.scrollTo({ top: 0, behavior: 'smooth' });
          
        } catch (error) {
          console.error('Reset error:', error);
          this.showNotification('Fehler beim Zurücksetzen der Daten', 'error');
        }
      }
      
      showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        if (!notification) return;
        
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.add('show');
        
        setTimeout(() => {
          notification.classList.remove('show');
        }, 4000);
      }
    }
    
    window.exportPDF = function() {
      try {
        if (window.healthApp) {
          window.healthApp.exportData();
        }
      } catch (error) {
        console.error('Export error:', error);
        alert('Fehler beim Exportieren der Daten');
      }
    };
    
    window.resetAll = function() {
      try {
        if (window.healthApp) {
          window.healthApp.resetData();
        }
      } catch (error) {
        console.error('Reset error:', error);
        alert('Fehler beim Zurücksetzen der Daten');
      }
    };
    
    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
      try {
        console.log('Initializing NH Score...');
        window.healthApp = new HealthAssessment();
        console.log('NH Score loaded successfully');
      } catch (error) {
        console.error('Failed to initialize health assessment:', error);
        
        // Show error in categories container
        const container = document.getElementById('categories');
        if (container) {
          container.innerHTML = `
            <div style="text-align: center; padding: 2rem; color: #ef4444; background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 8px; margin: 1rem 0;">
              <h3>Fehler beim Laden</h3>
              <p>JavaScript-Fehler: ${error.message}</p>
              <button style="margin-top: 1rem; padding: 0.5rem 1rem; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer;" onclick="location.reload()">
                Seite neu laden
              </button>
            </div>
          `;
        }
      }
    });
    
    window.addEventListener('beforeunload', (e) => {
      if (window.healthApp) {
        const answeredQuestions = window.healthApp.answers.flat().filter(answer => answer !== null).length;
        if (answeredQuestions > 0) {
          window.healthApp.saveData();
          
          if (answeredQuestions > 10) {
            e.preventDefault();
            e.returnValue = 'Sie haben ungespeicherte Änderungen. Möchten Sie die Seite wirklich verlassen?';
            return e.returnValue;
          }
        }
      }
    });
  </script>
</body>
</html>
